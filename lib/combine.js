'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.combine = combine;

var _adapter = require('./adapter');

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

function combine() {
  for (var _len = arguments.length, adapters = Array(_len), _key = 0; _key < _len; _key++) {
    adapters[_key] = arguments[_key];
  }

  var map = new WeakMap();

  var adapter = new _adapter.Adapter();
  adapter.getInfo = getInfo;
  adapter.getBuilder = getBuilder;
  adapter.getBuild = getBuild;
  adapter.getBuilders = getBuilders;
  adapter.getBuilds = getBuilds;
  return adapter;

  function getInfo() {
    return Promise.all(adapters.map(function (adapter) {
      return adapter.getInfo().then(addToMap(adapter));
    })).then(makeInfo);
  }

  function getBuilder(info, name) {
    var infos = info.data.filter(function (info) {
      return info.builders.indexOf(name) >= 0;
    });
    return Promise.all(infos.map(function (info) {
      var adapter = adapterFor(info);
      return adapter.getBuilder(info, name).then(addToMap(adapter));
    })).then(makeBuilder);
  }

  function getBuild(builder, number) {
    var builders = builder.data.filter(function (builder) {
      return builder.builds.indexOf(number) >= 0;
    });
    return Promise.all(builders.map(function (builder) {
      var adapter = adapterFor(builder);
      return adapter.getBuild(builder, number).then(addToMap(adapter));
    })).then(makeBuild);
  }

  function getBuilders(info) {
    var infos = info.data;
    return Promise.all(infos.map(function (info) {
      var adapter = adapterFor(info);
      return adapter.getBuilders(info).then(addAllToMap(adapter));
    })).then(function (lists) {
      var _ref;

      return (_ref = []).concat.apply(_ref, _toConsumableArray(lists));
    }).then(function (builders) {
      return builders.map(function (builder) {
        return makeBuilder([builder]);
      });
    });
  }

  function getBuilds(builder) {
    var builders = builder.data;
    return Promise.all(builders.map(function (builder) {
      var adapter = adapterFor(builder);
      return adapter.getBuilds(builder).then(addAllToMap(adapter));
    })).then(function (lists) {
      var _ref2;

      return (_ref2 = []).concat.apply(_ref2, _toConsumableArray(lists));
    }).then(function (builds) {
      return builds.map(function (build) {
        return makeBuild([build]);
      });
    });
  }

  function addToMap(adapter) {
    return function (item) {
      map.set(item, adapter);
      return item;
    };
  }

  function addAllToMap(adapter) {
    var add = addToMap(adapter);
    return function (iterable) {
      return iterable.map(add);
    };
  }

  function adapterFor(item) {
    return map.get(item);
  }

  function makeInfo(infos) {
    var names = infos.map(function (info) {
      return info.name;
    });
    var builders = infos.map(function (info) {
      return info.builders;
    });

    return {
      name: names.join(', '),
      builders: [].concat.apply([], builders),
      data: infos
    };
  }

  function makeBuilder(builders) {
    var first = builders && builders[0] || {};

    return {
      name: first.name,
      url: first.url,
      html_url: first.html_url,
      builds: [].concat.apply([], builders.map(function (builder) {
        return builder.builds;
      })).filter(function (k) {
        if (this[k]) return false;
        return this[k] = true;
      }, {}),
      data: builders
    };
  }

  function makeBuild(builds) {
    var first = builders && builders[0] || {};

    return {
      name: first.name,
      number: first.number,
      url: first.url,
      html_url: first.html_url,
      state: first.state,
      start: first.start,
      end: first.end,
      data: builds
    };
  }
}
//# sourceMappingURL=data:application/json;base64,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QUMsRUFBRTtBQUN2RixZQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEtBQUssQ0FBQztBQUMxQixlQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7T0FDdkIsRUFBRSxFQUFFLENBQUM7QUFDTixVQUFJLEVBQUUsUUFBUTtLQUNmLENBQUM7R0FDSDs7QUFFRCxXQUFTLFNBQVMsQ0FBQyxNQUFNLEVBQUU7QUFDekIsUUFBTSxLQUFLLEdBQUcsUUFBUSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7O0FBRTVDLFdBQU87QUFDTCxVQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7QUFDaEIsWUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO0FBQ3BCLFNBQUcsRUFBRSxLQUFLLENBQUMsR0FBRztBQUNkLGNBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtBQUN4QixXQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7QUFDbEIsV0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO0FBQ2xCLFNBQUcsRUFBRSxLQUFLLENBQUMsR0FBRztBQUNkLFVBQUksRUFBRSxNQUFNO0tBQ2IsQ0FBQztHQUNIO0NBQ0YiLCJmaWxlIjoiY29tYmluZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFkYXB0ZXIgfSBmcm9tICcuL2FkYXB0ZXInO1xuXG5leHBvcnQgZnVuY3Rpb24gY29tYmluZSguLi5hZGFwdGVycykge1xuICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcCgpO1xuXG4gIGNvbnN0IGFkYXB0ZXIgPSBuZXcgQWRhcHRlcigpO1xuICBhZGFwdGVyLmdldEluZm8gPSBnZXRJbmZvO1xuICBhZGFwdGVyLmdldEJ1aWxkZXIgPSBnZXRCdWlsZGVyO1xuICBhZGFwdGVyLmdldEJ1aWxkID0gZ2V0QnVpbGQ7XG4gIGFkYXB0ZXIuZ2V0QnVpbGRlcnMgPSBnZXRCdWlsZGVycztcbiAgYWRhcHRlci5nZXRCdWlsZHMgPSBnZXRCdWlsZHM7XG4gIHJldHVybiBhZGFwdGVyO1xuXG4gIGZ1bmN0aW9uIGdldEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGFkYXB0ZXJzLm1hcChmdW5jdGlvbiAoYWRhcHRlcikge1xuICAgICAgcmV0dXJuIGFkYXB0ZXIuZ2V0SW5mbygpXG4gICAgICAgIC50aGVuKGFkZFRvTWFwKGFkYXB0ZXIpKTtcbiAgICB9KSkudGhlbihtYWtlSW5mbyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRCdWlsZGVyKGluZm8sIG5hbWUpIHtcbiAgICBjb25zdCBpbmZvcyA9IGluZm8uZGF0YS5maWx0ZXIoaW5mbyA9PiBpbmZvLmJ1aWxkZXJzLmluZGV4T2YobmFtZSkgPj0gMCk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGluZm9zLm1hcChmdW5jdGlvbiAoaW5mbykge1xuICAgICAgY29uc3QgYWRhcHRlciA9IGFkYXB0ZXJGb3IoaW5mbyk7XG4gICAgICByZXR1cm4gYWRhcHRlci5nZXRCdWlsZGVyKGluZm8sIG5hbWUpXG4gICAgICAgIC50aGVuKGFkZFRvTWFwKGFkYXB0ZXIpKTtcbiAgICB9KSlcbiAgICAudGhlbihtYWtlQnVpbGRlcik7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRCdWlsZChidWlsZGVyLCBudW1iZXIpIHtcbiAgICBjb25zdCBidWlsZGVycyA9IGJ1aWxkZXIuZGF0YS5maWx0ZXIoYnVpbGRlciA9PiBidWlsZGVyLmJ1aWxkcy5pbmRleE9mKG51bWJlcikgPj0gMCk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGJ1aWxkZXJzLm1hcChmdW5jdGlvbiAoYnVpbGRlcikge1xuICAgICAgY29uc3QgYWRhcHRlciA9IGFkYXB0ZXJGb3IoYnVpbGRlcik7XG4gICAgICByZXR1cm4gYWRhcHRlci5nZXRCdWlsZChidWlsZGVyLCBudW1iZXIpXG4gICAgICAgIC50aGVuKGFkZFRvTWFwKGFkYXB0ZXIpKTtcbiAgICB9KSlcbiAgICAudGhlbihtYWtlQnVpbGQpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QnVpbGRlcnMoaW5mbykge1xuICAgIGNvbnN0IGluZm9zID0gaW5mby5kYXRhO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChpbmZvcy5tYXAoZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIGNvbnN0IGFkYXB0ZXIgPSBhZGFwdGVyRm9yKGluZm8pO1xuICAgICAgcmV0dXJuIGFkYXB0ZXIuZ2V0QnVpbGRlcnMoaW5mbylcbiAgICAgICAgLnRoZW4oYWRkQWxsVG9NYXAoYWRhcHRlcikpO1xuICAgIH0pKVxuICAgIC50aGVuKGxpc3RzID0+IFtdLmNvbmNhdCguLi5saXN0cykpXG4gICAgLnRoZW4oYnVpbGRlcnMgPT4gYnVpbGRlcnMubWFwKGJ1aWxkZXIgPT4gbWFrZUJ1aWxkZXIoW2J1aWxkZXJdKSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QnVpbGRzKGJ1aWxkZXIpIHtcbiAgICBjb25zdCBidWlsZGVycyA9IGJ1aWxkZXIuZGF0YTtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoYnVpbGRlcnMubWFwKGZ1bmN0aW9uIChidWlsZGVyKSB7XG4gICAgICBjb25zdCBhZGFwdGVyID0gYWRhcHRlckZvcihidWlsZGVyKTtcbiAgICAgIHJldHVybiBhZGFwdGVyLmdldEJ1aWxkcyhidWlsZGVyKVxuICAgICAgICAudGhlbihhZGRBbGxUb01hcChhZGFwdGVyKSk7XG4gICAgfSkpXG4gICAgLnRoZW4obGlzdHMgPT4gW10uY29uY2F0KC4uLmxpc3RzKSlcbiAgICAudGhlbihidWlsZHMgPT4gYnVpbGRzLm1hcChidWlsZCA9PiBtYWtlQnVpbGQoW2J1aWxkXSkpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZFRvTWFwKGFkYXB0ZXIpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIG1hcC5zZXQoaXRlbSwgYWRhcHRlcik7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkQWxsVG9NYXAoYWRhcHRlcikge1xuICAgIGNvbnN0IGFkZCA9IGFkZFRvTWFwKGFkYXB0ZXIpO1xuICAgIHJldHVybiBmdW5jdGlvbiAoaXRlcmFibGUpIHtcbiAgICAgIHJldHVybiBpdGVyYWJsZS5tYXAoYWRkKTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gYWRhcHRlckZvcihpdGVtKSB7XG4gICAgcmV0dXJuIG1hcC5nZXQoaXRlbSk7XG4gIH1cblxuICBmdW5jdGlvbiBtYWtlSW5mbyhpbmZvcykge1xuICAgIGNvbnN0IG5hbWVzID0gaW5mb3MubWFwKGluZm8gPT4gaW5mby5uYW1lKTtcbiAgICBjb25zdCBidWlsZGVycyA9IGluZm9zLm1hcChpbmZvID0+IGluZm8uYnVpbGRlcnMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IG5hbWVzLmpvaW4oJywgJyksXG4gICAgICBidWlsZGVyczogW10uY29uY2F0LmFwcGx5KFtdLCBidWlsZGVycyksXG4gICAgICBkYXRhOiBpbmZvc1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBtYWtlQnVpbGRlcihidWlsZGVycykge1xuICAgIGNvbnN0IGZpcnN0ID0gYnVpbGRlcnMgJiYgYnVpbGRlcnNbMF0gfHwge307XG5cbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogZmlyc3QubmFtZSxcbiAgICAgIHVybDogZmlyc3QudXJsLFxuICAgICAgaHRtbF91cmw6IGZpcnN0Lmh0bWxfdXJsLFxuICAgICAgYnVpbGRzOiBbXS5jb25jYXQuYXBwbHkoW10sIGJ1aWxkZXJzLm1hcChidWlsZGVyID0+IGJ1aWxkZXIuYnVpbGRzKSkuZmlsdGVyKGZ1bmN0aW9uIChrKSB7XG4gICAgICAgIGlmICh0aGlzW2tdKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzW2tdID0gdHJ1ZTtcbiAgICAgIH0sIHt9KSxcbiAgICAgIGRhdGE6IGJ1aWxkZXJzXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1ha2VCdWlsZChidWlsZHMpIHtcbiAgICBjb25zdCBmaXJzdCA9IGJ1aWxkZXJzICYmIGJ1aWxkZXJzWzBdIHx8IHt9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGZpcnN0Lm5hbWUsXG4gICAgICBudW1iZXI6IGZpcnN0Lm51bWJlcixcbiAgICAgIHVybDogZmlyc3QudXJsLFxuICAgICAgaHRtbF91cmw6IGZpcnN0Lmh0bWxfdXJsLFxuICAgICAgc3RhdGU6IGZpcnN0LnN0YXRlLFxuICAgICAgc3RhcnQ6IGZpcnN0LnN0YXJ0LFxuICAgICAgZW5kOiBmaXJzdC5lbmQsXG4gICAgICBkYXRhOiBidWlsZHNcbiAgICB9O1xuICB9XG59XG5cbiJdfQ==