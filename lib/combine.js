'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.combine = combine;

var _adapter = require('./adapter');

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

function combine() {
  for (var _len = arguments.length, adapters = Array(_len), _key = 0; _key < _len; _key++) {
    adapters[_key] = arguments[_key];
  }

  var map = new WeakMap();
  var adapter = new _adapter.Adapter();

  return Object.create(adapter, {
    getInfo: { value: getInfo },
    getBuilder: { value: getBuilder },
    getBuild: { value: getBuild },
    getBuilders: { value: getBuilders },
    getBuilds: { value: getBuilds }
  });

  function getInfo() {
    return Promise.all(adapters.map(function (adapter) {
      return adapter.getInfo().then(addToMap(adapter));
    })).then(makeInfo);
  }

  function getBuilder(info, name) {
    var infos = info.data.filter(function (info) {
      return info.builders.indexOf(name) >= 0;
    });
    return Promise.all(infos.map(function (info) {
      var adapter = adapterFor(info);
      return adapter.getBuilder(info, name).then(addToMap(adapter));
    })).then(makeBuilder);
  }

  function getBuild(builder, number) {
    var builders = builder.data.filter(function (builder) {
      return builder.builds.indexOf(number) >= 0;
    });
    return Promise.all(builders.map(function (builder) {
      var adapter = adapterFor(builder);
      return adapter.getBuild(builder, number).then(addToMap(adapter));
    })).then(makeBuild);
  }

  function getBuilders(info) {
    var infos = info.data;
    return Promise.all(infos.map(function (info) {
      var adapter = adapterFor(info);
      return adapter.getBuilders(info).then(addAllToMap(adapter));
    })).then(function (lists) {
      var _ref;

      return (_ref = []).concat.apply(_ref, _toConsumableArray(lists));
    }).then(function (builders) {
      return builders.map(function (builder) {
        return makeBuilder([builder]);
      });
    });
  }

  function getBuilds(builder) {
    var builders = builder.data;
    return Promise.all(builders.map(function (builder) {
      var adapter = adapterFor(builder);
      return adapter.getBuilds(builder).then(addAllToMap(adapter));
    })).then(function (lists) {
      var _ref2;

      return (_ref2 = []).concat.apply(_ref2, _toConsumableArray(lists));
    }).then(function (builds) {
      return builds.map(function (build) {
        return makeBuild([build]);
      });
    });
  }

  function addToMap(adapter) {
    return function (item) {
      map.set(item, adapter);
      return item;
    };
  }

  function addAllToMap(adapter) {
    var add = addToMap(adapter);
    return function (iterable) {
      return iterable.map(add);
    };
  }

  function adapterFor(item) {
    return map.get(item);
  }

  function makeInfo(infos) {
    var names = infos.map(function (info) {
      return info.name;
    });
    var builders = infos.map(function (info) {
      return info.builders;
    });

    return {
      name: names.join(', '),
      builders: [].concat.apply([], builders),
      data: infos
    };
  }

  function makeBuilder(builders) {
    var first = builders && builders[0] || {};

    return {
      name: first.name,
      url: first.url,
      html_url: first.html_url,
      builds: [].concat.apply([], builders.map(function (builder) {
        return builder.builds;
      })).filter(function (k) {
        if (this[k]) return false;
        return this[k] = true;
      }, {}),
      data: builders
    };
  }

  function makeBuild(builds) {
    var first = builds && builds[0] || {};

    return {
      name: first.name,
      number: first.number,
      url: first.url,
      html_url: first.html_url,
      state: first.state,
      start: first.start,
      end: first.end,
      data: builds
    };
  }
}
//# sourceMappingURL=data:application/json;base64,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QUFPO2VBQUksT0FBTyxDQUFDLE1BQU07T0FBQSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFDdkYsWUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxLQUFLLENBQUM7QUFDMUIsZUFBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO09BQ3ZCLEVBQUUsRUFBRSxDQUFDO0FBQ04sVUFBSSxFQUFFLFFBQVE7S0FDZixDQUFDO0dBQ0g7O0FBRUQsV0FBUyxTQUFTLENBQUMsTUFBTSxFQUFFO0FBQ3pCLFFBQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDOztBQUV4QyxXQUFPO0FBQ0wsVUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO0FBQ2hCLFlBQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtBQUNwQixTQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUc7QUFDZCxjQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7QUFDeEIsV0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO0FBQ2xCLFdBQUssRUFBRSxLQUFLLENBQUMsS0FBSztBQUNsQixTQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUc7QUFDZCxVQUFJLEVBQUUsTUFBTTtLQUNiLENBQUM7R0FDSDtDQUNGIiwiZmlsZSI6ImNvbWJpbmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZGFwdGVyIH0gZnJvbSAnLi9hZGFwdGVyJztcblxuZXhwb3J0IGZ1bmN0aW9uIGNvbWJpbmUoLi4uYWRhcHRlcnMpIHtcbiAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgYWRhcHRlciA9IG5ldyBBZGFwdGVyKCk7XG5cbiAgcmV0dXJuIE9iamVjdC5jcmVhdGUoYWRhcHRlciwge1xuICAgIGdldEluZm86IHsgdmFsdWU6IGdldEluZm8gfSxcbiAgICBnZXRCdWlsZGVyOiB7IHZhbHVlOiBnZXRCdWlsZGVyIH0sXG4gICAgZ2V0QnVpbGQ6IHsgdmFsdWU6IGdldEJ1aWxkIH0sXG4gICAgZ2V0QnVpbGRlcnM6IHsgdmFsdWU6IGdldEJ1aWxkZXJzIH0sXG4gICAgZ2V0QnVpbGRzOiB7IHZhbHVlOiBnZXRCdWlsZHMgfVxuICB9KTtcblxuICBmdW5jdGlvbiBnZXRJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChhZGFwdGVycy5tYXAoZnVuY3Rpb24gKGFkYXB0ZXIpIHtcbiAgICAgIHJldHVybiBhZGFwdGVyLmdldEluZm8oKVxuICAgICAgICAudGhlbihhZGRUb01hcChhZGFwdGVyKSk7XG4gICAgfSkpLnRoZW4obWFrZUluZm8pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QnVpbGRlcihpbmZvLCBuYW1lKSB7XG4gICAgY29uc3QgaW5mb3MgPSBpbmZvLmRhdGEuZmlsdGVyKGluZm8gPT4gaW5mby5idWlsZGVycy5pbmRleE9mKG5hbWUpID49IDApO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChpbmZvcy5tYXAoZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIGNvbnN0IGFkYXB0ZXIgPSBhZGFwdGVyRm9yKGluZm8pO1xuICAgICAgcmV0dXJuIGFkYXB0ZXIuZ2V0QnVpbGRlcihpbmZvLCBuYW1lKVxuICAgICAgICAudGhlbihhZGRUb01hcChhZGFwdGVyKSk7XG4gICAgfSkpXG4gICAgLnRoZW4obWFrZUJ1aWxkZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QnVpbGQoYnVpbGRlciwgbnVtYmVyKSB7XG4gICAgY29uc3QgYnVpbGRlcnMgPSBidWlsZGVyLmRhdGEuZmlsdGVyKGJ1aWxkZXIgPT4gYnVpbGRlci5idWlsZHMuaW5kZXhPZihudW1iZXIpID49IDApO1xuICAgIHJldHVybiBQcm9taXNlLmFsbChidWlsZGVycy5tYXAoZnVuY3Rpb24gKGJ1aWxkZXIpIHtcbiAgICAgIGNvbnN0IGFkYXB0ZXIgPSBhZGFwdGVyRm9yKGJ1aWxkZXIpO1xuICAgICAgcmV0dXJuIGFkYXB0ZXIuZ2V0QnVpbGQoYnVpbGRlciwgbnVtYmVyKVxuICAgICAgICAudGhlbihhZGRUb01hcChhZGFwdGVyKSk7XG4gICAgfSkpXG4gICAgLnRoZW4obWFrZUJ1aWxkKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEJ1aWxkZXJzKGluZm8pIHtcbiAgICBjb25zdCBpbmZvcyA9IGluZm8uZGF0YTtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoaW5mb3MubWFwKGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICBjb25zdCBhZGFwdGVyID0gYWRhcHRlckZvcihpbmZvKTtcbiAgICAgIHJldHVybiBhZGFwdGVyLmdldEJ1aWxkZXJzKGluZm8pXG4gICAgICAgIC50aGVuKGFkZEFsbFRvTWFwKGFkYXB0ZXIpKTtcbiAgICB9KSlcbiAgICAudGhlbihsaXN0cyA9PiBbXS5jb25jYXQoLi4ubGlzdHMpKVxuICAgIC50aGVuKGJ1aWxkZXJzID0+IGJ1aWxkZXJzLm1hcChidWlsZGVyID0+IG1ha2VCdWlsZGVyKFtidWlsZGVyXSkpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEJ1aWxkcyhidWlsZGVyKSB7XG4gICAgY29uc3QgYnVpbGRlcnMgPSBidWlsZGVyLmRhdGE7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGJ1aWxkZXJzLm1hcChmdW5jdGlvbiAoYnVpbGRlcikge1xuICAgICAgY29uc3QgYWRhcHRlciA9IGFkYXB0ZXJGb3IoYnVpbGRlcik7XG4gICAgICByZXR1cm4gYWRhcHRlci5nZXRCdWlsZHMoYnVpbGRlcilcbiAgICAgICAgLnRoZW4oYWRkQWxsVG9NYXAoYWRhcHRlcikpO1xuICAgIH0pKVxuICAgIC50aGVuKGxpc3RzID0+IFtdLmNvbmNhdCguLi5saXN0cykpXG4gICAgLnRoZW4oYnVpbGRzID0+IGJ1aWxkcy5tYXAoYnVpbGQgPT4gbWFrZUJ1aWxkKFtidWlsZF0pKSk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRUb01hcChhZGFwdGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBtYXAuc2V0KGl0ZW0sIGFkYXB0ZXIpO1xuICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZEFsbFRvTWFwKGFkYXB0ZXIpIHtcbiAgICBjb25zdCBhZGQgPSBhZGRUb01hcChhZGFwdGVyKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZXJhYmxlKSB7XG4gICAgICByZXR1cm4gaXRlcmFibGUubWFwKGFkZCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkYXB0ZXJGb3IoaXRlbSkge1xuICAgIHJldHVybiBtYXAuZ2V0KGl0ZW0pO1xuICB9XG5cbiAgZnVuY3Rpb24gbWFrZUluZm8oaW5mb3MpIHtcbiAgICBjb25zdCBuYW1lcyA9IGluZm9zLm1hcChpbmZvID0+IGluZm8ubmFtZSk7XG4gICAgY29uc3QgYnVpbGRlcnMgPSBpbmZvcy5tYXAoaW5mbyA9PiBpbmZvLmJ1aWxkZXJzKTtcblxuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBuYW1lcy5qb2luKCcsICcpLFxuICAgICAgYnVpbGRlcnM6IFtdLmNvbmNhdC5hcHBseShbXSwgYnVpbGRlcnMpLFxuICAgICAgZGF0YTogaW5mb3NcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gbWFrZUJ1aWxkZXIoYnVpbGRlcnMpIHtcbiAgICBjb25zdCBmaXJzdCA9IGJ1aWxkZXJzICYmIGJ1aWxkZXJzWzBdIHx8IHt9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGZpcnN0Lm5hbWUsXG4gICAgICB1cmw6IGZpcnN0LnVybCxcbiAgICAgIGh0bWxfdXJsOiBmaXJzdC5odG1sX3VybCxcbiAgICAgIGJ1aWxkczogW10uY29uY2F0LmFwcGx5KFtdLCBidWlsZGVycy5tYXAoYnVpbGRlciA9PiBidWlsZGVyLmJ1aWxkcykpLmZpbHRlcihmdW5jdGlvbiAoaykge1xuICAgICAgICBpZiAodGhpc1trXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gdGhpc1trXSA9IHRydWU7XG4gICAgICB9LCB7fSksXG4gICAgICBkYXRhOiBidWlsZGVyc1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBtYWtlQnVpbGQoYnVpbGRzKSB7XG4gICAgY29uc3QgZmlyc3QgPSBidWlsZHMgJiYgYnVpbGRzWzBdIHx8IHt9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGZpcnN0Lm5hbWUsXG4gICAgICBudW1iZXI6IGZpcnN0Lm51bWJlcixcbiAgICAgIHVybDogZmlyc3QudXJsLFxuICAgICAgaHRtbF91cmw6IGZpcnN0Lmh0bWxfdXJsLFxuICAgICAgc3RhdGU6IGZpcnN0LnN0YXRlLFxuICAgICAgc3RhcnQ6IGZpcnN0LnN0YXJ0LFxuICAgICAgZW5kOiBmaXJzdC5lbmQsXG4gICAgICBkYXRhOiBidWlsZHNcbiAgICB9O1xuICB9XG59XG5cbiJdfQ==